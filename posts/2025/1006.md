---
cover: https://buc.civer.cn/picgo/0306cover.jpg
title: 自定义Swap
tags: [Swap, Linux]
categories: [学习经验,技术分享]
date: 2025-10-06
description: 介绍如何自定义临时Swap，以及脚本方式开启、删除
articleGPT: 介绍如何自定义临时Swap，以及脚本方式开启、删除
---

# 自定义Swap

## 1. 命令行临时方式

```shell
# 创建 1GB 临时 swap 文件
sudo fallocate -l 1G /tmp/myswapfile
# 设置权限
sudo chmod 600 /tmp/myswapfile
# 格式化成 swap
sudo mkswap /tmp/myswapfile
# 启用 swap
sudo swapon /tmp/myswapfile
# 查看内存
free -h
```

### 删除Swap（关机自动删除

```shell
sudo swapoff /tmp/myswapfile
rm /tmp/myswapfile
```

## 2. 自启动脚本方式

**创建swap脚本**`/home/auto/create-swap.sh`

```bash
sudo nano /home/auto/create-swap.sh
```



```bash
#!/bin/bash
SWAPFILE=/swapfile
SWAPSIZE=1G   # 你可以改大小

# 如果 swap 文件不存在，就创建
if [ ! -f $SWAPFILE ]; then
    fallocate -l $SWAPSIZE $SWAPFILE
    chmod 600 $SWAPFILE
    mkswap $SWAPFILE
fi

# 启用 swap
swapon $SWAPFILE
```

授予执行权限

```bash
chmod +x /home/auto/create-swap.sh
```

**创建 systemd 服务** `/etc/systemd/system/tempswap.service`

```bash
sudo nano /etc/systemd/system/tempswap.service
```



```shell
[Unit]
Description=Temporary Swap Service
DefaultDependencies=no
After=local-fs.target
Before=multi-user.target

[Service]
Type=oneshot
ExecStart=/home/auto/create-swap.sh
RemainAfterExit=true

[Install]
WantedBy=multi-user.target
```

**启动服务**

```shell
systemctl daemon-reload
systemctl enable tempswap.service
systemctl start tempswap.service
```

### 删除脚本

**删除脚本内容（清除所有）**

```bash
nano /home/auto/remove_tempswap.sh
```



```bash
#!/bin/bash

# 停止并禁用 service
echo "Stopping and disabling tempswap.service..."
systemctl stop tempswap.service 2>/dev/null
systemctl disable tempswap.service 2>/dev/null

# 删除 service 文件
if [ -f /etc/systemd/system/tempswap.service ]; then
    echo "Removing /etc/systemd/system/tempswap.service..."
    rm -f /etc/systemd/system/tempswap.service
fi

# 重新加载 systemd 配置
systemctl daemon-reload

# 删除创建 swap 的脚本
if [ -f /home/auto/create-swap.sh ]; then
    echo "Removing /home/auto/create-swap.sh..."
    rm -f /home/auto/create-swap.sh
fi

# 关闭 swap 并删除 swap 文件
if swapon --show | grep -q '/swapfile'; then
    echo "Turning off swap..."
    swapoff /swapfile
fi

if [ -f /swapfile ]; then
    echo "Removing /swapfile..."
    rm -f /swapfile
fi

echo "Temporary swap service
```

**授予脚本权限**

```bash
chmod +x /home/auto/remove_tempswap.sh
```

**运行**

```bash
sudo /usr/local/bin/remove_tempswap.sh
```

